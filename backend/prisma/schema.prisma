// --- 1. ส่วนหัว ---
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- 2. ส่วน Model (ตาราง) ---

// ✅ เพิ่มตาราง Category ตามที่ขอ
model Category {
  cg_id   Int    @id @default(autoincrement())
  mode_cg String // ชื่อหมวดหมู่ (เช่น "ความรู้ทั่วไป", "กลโกง")

  // Relation: เอาไว้เชื่อมกับ Game และ Questions
  games     Game[]
  questions Questions[]

  @@map("category")
}

model User {
  uid       Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  email     String   @unique
  phone     String   @unique
  birthdate DateTime
  address   String?

  games      Game[]
  answerLogs AnswerLogs[]

  @@map("user")
}

model Questions {
  qid      Int    @id @default(autoincrement())
  level    String
  question String
  explanation String? @db.Text
  // ✅ เพิ่ม: เชื่อมกับ Category (เพื่อให้รู้ว่าคำถามนี้อยู่หมวดไหน)
  cg_id    Int?   
  category Category? @relation(fields: [cg_id], references: [cg_id])

  choices    Choices[]
  answerLogs AnswerLogs[]

  @@map("questions")
}

model Choices {
  cid         Int     @id @default(autoincrement())
  qid         Int
  choice_text String
  is_correct  Boolean

  question   Questions    @relation(fields: [qid], references: [qid], onDelete: Cascade)
  answerLogs AnswerLogs[]

  @@map("choices")
}

model Game {
  gid         Int       @id @default(autoincrement())
  uid         Int       
  
  // ✅ แก้ไข: เชื่อมกับ Category (เพื่อให้รู้ว่าเกมนี้เล่นหมวดไหน)
  cg_id       Int?      
  category    Category? @relation(fields: [cg_id], references: [cg_id])

  total_score Int       @default(0)
  time_taken  Float?    
  started_at  DateTime  @default(now())
  finished_at DateTime? 

  user       User       @relation(fields: [uid], references: [uid], onDelete: Cascade)
  answerLogs AnswerLogs[]

  @@map("game")
}

model AnswerLogs {
  al_id       Int      @id @default(autoincrement())
  gid         Int      
  uid         Int      
  qid         Int      
  cid         Int      
  is_correct  Boolean
  answered_at DateTime @default(now())

  game     Game      @relation(fields: [gid], references: [gid], onDelete: Cascade)
  user     User      @relation(fields: [uid], references: [uid], onDelete: Cascade)
  question Questions @relation(fields: [qid], references: [qid], onDelete: Cascade)
  choice   Choices   @relation(fields: [cid], references: [cid], onDelete: Cascade)

  @@map("answer_logs")
}